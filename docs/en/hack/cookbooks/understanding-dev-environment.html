<!DOCTYPE html><!--[if lte IE 7]> <html class="no-js ie67 ie678" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js ie8 ie678" lang="en"> <![endif]-->
<!--[if IE 9]> <html class="no-js ie9" lang="en"> <![endif]-->
<html lang="en">
  <head>
    <meta charset="utf-8"><!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/cozy-docs/assets/images/favicon.png">
    <title>Understanding Cozy's development environment
    </title><link  rel="stylesheet" href="/cozy-docs/vendors/css/knacss.css" /><link  rel="stylesheet" href="/cozy-docs/vendors/css/sunburst.css" /><link  rel="stylesheet" href="/cozy-docs/assets/css/main.css" />
  </head>
  <body>
    <div class="navbar fixed"><a href="/en/" class="nav-logo"><img src="/cozy-docs/assets/images/cozy-logo-docs.svg"></a>
      <ul class="subtitle">
        <li><a href="/en/hack/getting-started/">Getting started</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/getting-started/setup-environment.html">Setting up the environment</a></li>
            <li><a href="/en/hack/getting-started/first-app.html">Your first app in 30 minutes</a></li>
            <li><a href="/en/hack/getting-started/architecture-overview.html">Understand the Cozy Architecture</a></li>
            <li><a href="/en/hack/getting-started/play-with-data-system.html">Play with the Data System</a></li>
            <li><a href="/en/hack/getting-started/discover-americano.html">Discover Americano</a></li>
            <li><a href="/en/hack/getting-started/learn-single-page-app-way.html">Learn the Single Page App Way</a></li>
          </ul>
        </li>
        <li><a href="/en/hack/cookbooks/" class="selected">Cookbooks</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/cookbooks/data-system.html">The Data System API</a></li>
            <li><a href="/en/hack/cookbooks/controller.html">The Controller API</a></li>
            <li><a href="/en/hack/cookbooks/data-system-odm.html">The ODM for Data System API</a></li>
            <li><a href="/en/hack/cookbooks/understanding-dev-environment.html">Understanding Cozy's development environment</a></li>
            <li><a href="/en/hack/cookbooks/deploy.html">Deploy your application</a></li>
            <li><a href="/en/hack/cookbooks/localization.html">Localize your applications</a></li>
            <li><a href="/en/hack/cookbooks/debugging.html">Debug your application</a></li>
            <li><a href="/en/hack/cookbooks/debugging-production.html">Debug in production environment</a></li>
            <li><a href="/en/hack/cookbooks/nodemon-server-auto-refresh-on-change.html">Using nodemon to auto-refresh the server on code change</a></li>
            <li><a href="/en/hack/cookbooks/connect-a-device.html">Connect a device to a Cozy</a></li>
            <li><a href="/en/hack/cookbooks/components.html">Components</a></li>
            <li><a href="/en/hack/cookbooks/authentication-authorization-workflows.html">Authentication and Authorization workflows</a></li>
            <li><a href="/en/hack/cookbooks/encryption.html">Encryption management</a></li>
          </ul>
        </li>
        <li><a href="/en/hack/application-skeletons/">Application Skeletons</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/application-skeletons/cozy-official.html">Official Cozy skeleton</a></li>
          </ul>
        </li>
        <li><a href="/en/hack/contributing/">Contributing</a>
        </li>
        <li><a href="/en/hack/releases/">Releases</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/releases/patch-notes-17.html">Patch notes 2015/12/02</a></li>
            <li><a href="/en/hack/releases/patch-notes-18.html">Last release note</a></li>
          </ul>
        </li>
      </ul>
      <ul class="navigation">
        <li><a href="/en/host/install/">Install</a>
        </li>
        <li><a href="/en/mobile/files.html">Sync</a>
        </li>
        <li><a href="https://dev.cozy.io" class="selected">Dev</a>
        </li>
      </ul>
    </div>
    <div class="wrapper">
      <div id="main" role="main" class="mod pam selected"><h1 id="understanding-cozy-s-development-environment">Understanding Cozy&#39;s development environment</h1>
<p>In the step-to-step documentation, we scratch the surface of the development environment, showing you what you need when you need it. This cookbook describes precisely all the available commands, and how you should develop your app for Cozy.</p>
<p>The development environment is made of a CLI tool and a virtual machine. The CLI tool allows you to manage the virtual machine, so don&#39;t worry.</p>
<p><br />
The whole point is to help you focus on your application, without caring too much about how Cozy itself works. If you have any suggestion to help us improve the development environment, let us know!</p>
<h2 id="installation">Installation</h2>
<p>Install the CLI tool:</p>
<pre class="highlight"><code class="hljs bash">sudo npm install -g cozy-dev
</code></pre>
<p>You also need Virtualbox and Vagrant in order to run the virtual machine. Please see our <a href="/en/hack/getting-started/setup-environment.html">getting started</a> if you haven&#39;t installed them yet.</p>
<h2 id="classic-setup">Classic setup</h2>
<p>This is how you will develop your applications. Run the application on your computer, test it out. If you need features from Cozy, just use them as if they were on <code>localhost</code>, the virtual machine provides them thanks to port forwarding.</p>
<p>The virtual machine is basically a real Cozy without the security. You can use it from <code>http://localhost:9104/</code></p>
<center><a href="/assets/images/cozy-dev-setup.svg" target="_blank">
<img src="/assets/images/cozy-dev-setup.svg" alt="Classic setup with cozy-dev">
(Click to enlarge)
</a></center>

<p><br />
If you want to see your app in action like if it was installed in Cozy, just use the following command in the root folder of your application:</p>
<pre class="highlight"><code class="hljs bash">cozy-dev deploy
</code></pre>
<p>Then you can access it from <code>http://localhost:9104/apps/{yourAppSlug}/</code></p>
<p><code>{yourAppSlug}</code> is defined in <code>package.json</code> in the field <code>name</code>.</p>
<p>All the commands are details in the next sections.</p>
<h2 id="managing-the-virtual-machine">Managing the virtual machine</h2>
<h3 id="vm-init">vm:init</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev vm:init
</code></pre>
<p>You have to use this command only the first time you use cozy-dev. It downloads and setup the virtual machine image.</p>
<h3 id="vm-start">vm:start</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev vm:start
</code></pre>
<p>Start the virtual machine.</p>
<h3 id="vm-status">vm:status</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev vm:status
</code></pre>
<p>Check that every part of Cozy is properly running in the virtual machine.</p>
<h3 id="vm-update">vm:update</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev vm:update
</code></pre>
<p>Run a script to update the software within the virtual machine. NO DATA LOSS.
Before update your virtual machine, you should start it (<code>cozy-dev vm:start</code>).</p>
<h3 id="vm-update-image">vm:update-image</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev vm:update-image
</code></pre>
<p>Destroy and re-download the virtual machine image. ALL DATA WILL BE LOST.</p>
<h3 id="vm-stop">vm:stop</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev vm:stop [--halt]
</code></pre>
<p>Pause the virtual machine (persist its state on your hard drive). If you use <code>--halt</code>, it will stop the virtual machine (real stop).</p>
<h3 id="vm-destroy">vm:destroy</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev vm:destroy
</code></pre>
<p>Destroy the virtual machine. ALL DATA WILL BE LOST.</p>
<h2 id="developing-an-application">Developing an application</h2>
<h3 id="new">new</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev new &lt;appName&gt; [--coffee]
</code></pre>
<p>Create a new application folder <code>appName</code> based on <a href="https://github.com/cozy/cozy-template">https://github.com/cozy/cozy-template</a>.
If you want to create a new application based on the coffee template (<a href="https://github.com/cozy/cozy-template-coffee">https://github.com/cozy/cozy-template-coffee</a>), use the option <code>--coffee</code>.</p>
<h3 id="deploy">deploy</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev deploy &lt;port&gt;
</code></pre>
<p>Trick the virtual machine to make it think your application is actually installed in the Cozy. By default, <code>port</code> is 9250. It will use the <code>package.json</code> at the root of your application to get the application&#39;s slug.
Basically, it doesn&#39;t change anything for you, except that you can access your app through the Cozy interface. Just run the <code>deploy</code> command, and start your application&#39;s server like you are used to.</p>
<center><a href="/assets/images/cozy-dev-setup-deploy.svg" target="_blank">
<img src="/assets/images/cozy-dev-setup-deploy.svg" alt="Classic setup with cozy-dev with deploy">
(Click to enlarge)
</a></center>

<p>Normally you just need to deploy one time your app at the root of your document, unless you change his name in package.json (CozyCloud will get the name of the app in this file). You will see your server working when you access your app in CozyCloud. If you make changes in your server but it does not show on CozyCloud, please refresh the page by clicking on F5. Sometimes the app does not load when the cache is not emptied.</p>
<p>An other detail : cozy-dev deploy only gives the port of the machine at the VM. So you still need to start the server on your machine.</p>
<h3 id="undeploy">undeploy</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev undeploy
</code></pre>
<p>Revert a previous <code>cozy-dev deploy</code> command.</p>
<h2 id="managing-the-database">Managing the database</h2>
<h3 id="db-switch">db:switch</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev db:switch [dbName]
</code></pre>
<p>Switch the database used by the virtual machine. By default, <code>dbName</code> is <code>cozy</code>.</p>
<p>This command is very useful if you want to run tests in isolation!</p>
<h3 id="db-reset">db:reset</h3>
<pre class="highlight"><code class="hljs bash">cozy-dev db: reset &lt;dbName&gt; [--force]
</code></pre>
<p>Reset the given database. All data will be lost, use at your own risk! If you want to not be prompted a confirmation message, you can use <code>--force</code>.</p>
<p>This command is very useful if you want to run tests in isolation!</p>

      </div>
      <footer id="footer" role="contentinfo"><a href="https://github.com/cozy"><img src="/cozy-docs/assets/images/icons/icon-github.svg">Github</a><a href="irc://irc.freenode.net/cozycloud"><img src="/cozy-docs/assets/images/icons/icon-message.svg">IRC</a><a href="https://forum.cozy.io"><img src="/cozy-docs/assets/images/icons/icon-smiley.svg">Forum</a><a href="mailto:contact@cozycloud.cc"><img src="/cozy-docs/assets/images/icons/icon-mail.svg">Contact</a><a href="https://www.cozy.io"><img src="/cozy-docs/assets/images/icons/icon-cloud.svg">Cozy's site</a></footer>
    </div><script defer="defer"  src="/cozy-docs/vendors/javascripts/jquery-2.0.3.min.js"></script><script defer="defer"  src="/cozy-docs/vendors/javascripts/bootstrap.min.js"></script><script defer="defer"  src="/cozy-docs/assets/javascripts/main.js"></script>
    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['disableCookies']);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
      var u="//piwik.cozycloud.cc/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', 7]);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <noscript>
      <p><img src="https://piwik.cozycloud.cc/piwik.php?idsite=7" style="border:0" alt=""></p>
    </noscript>
  </body>
</html>