<!DOCTYPE html><!--[if lte IE 7]> <html class="no-js ie67 ie678" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js ie8 ie678" lang="en"> <![endif]-->
<!--[if IE 9]> <html class="no-js ie9" lang="en"> <![endif]-->
<html lang="en">
  <head>
    <meta charset="utf-8"><!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <title>Learn the Single Page App Way
    </title><link  rel="stylesheet" href="/vendors/css/knacss.css" /><link  rel="stylesheet" href="/vendors/css/sunburst.css" /><link  rel="stylesheet" href="/assets/css/main.css" />
  </head>
  <body>
    <div class="navbar fixed"><a href="/en/" class="nav-logo"><img src="/assets/images/cozy-logo-docs.svg"></a>
      <ul class="subtitle">
        <li><a href="/en/hack/getting-started/" class="selected">Getting started</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/getting-started/setup-environment.html">Setting up the environment</a></li>
            <li><a href="/en/hack/getting-started/first-app.html">Your first app in 30 minutes</a></li>
            <li><a href="/en/hack/getting-started/architecture-overview.html">Understand the Cozy Architecture</a></li>
            <li><a href="/en/hack/getting-started/play-with-data-system.html">Play with the Data System</a></li>
            <li><a href="/en/hack/getting-started/discover-americano.html">Discover Americano</a></li>
            <li><a href="/en/hack/getting-started/learn-single-page-app-way.html">Learn the Single Page App Way</a></li>
          </ul>
        </li>
        <li><a href="/en/hack/cookbooks/">Cookbooks</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/cookbooks/data-system.html">The Data System API</a></li>
            <li><a href="/en/hack/cookbooks/controller.html">The Controller API</a></li>
            <li><a href="/en/hack/cookbooks/data-system-odm.html">The ODM for Data System API</a></li>
            <li><a href="/en/hack/cookbooks/understanding-dev-environment.html">Understanding Cozy's development environment</a></li>
            <li><a href="/en/hack/cookbooks/deploy.html">Deploy your application</a></li>
            <li><a href="/en/hack/cookbooks/localization.html">Localize your applications</a></li>
            <li><a href="/en/hack/cookbooks/debugging.html">Debug your application</a></li>
            <li><a href="/en/hack/cookbooks/debugging-production.html">Debug in production environment</a></li>
            <li><a href="/en/hack/cookbooks/nodemon-server-auto-refresh-on-change.html">Using nodemon to auto-refresh the server on code change</a></li>
            <li><a href="/en/hack/cookbooks/connect-a-device.html">Connect a device to a Cozy</a></li>
            <li><a href="/en/hack/cookbooks/components.html">Components</a></li>
            <li><a href="/en/hack/cookbooks/authentication-authorization-workflows.html">Authentication and Authorization workflows</a></li>
            <li><a href="/en/hack/cookbooks/encryption.html">Encryption management</a></li>
          </ul>
        </li>
        <li><a href="/en/hack/application-skeletons/">Application Skeletons</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/application-skeletons/cozy-official.html">Official Cozy skeleton</a></li>
          </ul>
        </li>
        <li><a href="/en/hack/contributing/">Contributing</a>
        </li>
        <li><a href="/en/hack/releases/">Releases</a>
          <ul class="dropdown-menu">
            <li><a href="/en/hack/releases/patch-notes-17.html">Patch notes 2015/12/02</a></li>
            <li><a href="/en/hack/releases/patch-notes-18.html">Last release note</a></li>
          </ul>
        </li>
      </ul>
      <ul class="navigation">
        <li><a href="/en/host/install/">Install</a>
        </li>
        <li><a href="/en/mobile/files.html">Sync</a>
        </li>
        <li><a href="https://dev.cozy.io" class="selected">Dev</a>
        </li>
      </ul>
    </div>
    <div class="wrapper">
      <div id="main" role="main" class="mod pam selected"><h1 id="learn-the-single-page-app-way">Learn the single page app way</h1>
<p>So far, we have built classic web applications in which a server delivers HTML pages to the browser. This is a &quot;multiple page application&quot; approach, meaning that you have one HTML file for each page of your website.</p>
<p>Single page applications are made of one page and tons of JavaScript. While this is not a good news for some users (who like to disable JavaScript), it offers the rest of your users the following advantages:</p>
<ul>
<li>better user experience: it feels more like a native application</li>
<li>less network consumption: it only loads the needed data thanks to Ajax</li>
<li>better application architecture: you can build nice maintainable application by applying separation of concerns (MVC like stuff)</li>
<li>the server is only a REST API, easy to request from the single page app or any other client (mobile!)</li>
</ul>
<p>From now on we&#39;ll use the acronym &quot;SPA&quot; to talk about Single Page Apps or everyone is going to shoot themselves.</p>
<p>For example, when a user clicks a button, instead of waiting for the entire page to reload as in a traditional server-side web application, the SPA only load in portions of the page as the user interacts with them, thus speeding up the responsiveness of the user interface. </p>
<p>Of course, you can do similar things with a traditional app and a bit of jQuery, but if you’ve ever tried that then you know how quickly you can run into trouble. Unless you’re dealing with something simple, code management with jQuery quickly becomes a challenge, often leading to <a href="https://en.wikipedia.org/wiki/Spaghetti_code">“spaghetti”</a> code.</p>
<p>But if you want to know everything about single page app, we advise you to <a href="http://singlepageappbook.com/">check out this resource</a> in order to learn more about SPA.</p>
<p>Let&#39;s make your bookmark application with the single page app way!</p>
<p><strong>Hint</strong>: If you are later starting to build an app from scratch, the <code>cozy-dev new &lt;appname&gt;</code> command will take care of creating a project directory with a skeleton app structure for you.</p>
<h3 id="front-end-javascript-framework">Front-end javascript framework</h3>
<p>Modern JavaScript frameworks offer a way around the problem of code management by providing well-defined application architectures (often using the MVC design pattern, which jQuery lacks) that can greatly ease development. They all have the concept of views, events, data models, routing... So in using one of these frameworks, we get highly responsive user interfaces along with well structured and maintainable code, which can be a huge time saver in the long run.</p>
<p>Now that we have a general idea of why these frameworks are getting so much attention, let’s look at each at the two most popular ones : Backbone.js and Angular.js.</p>
<h3 id="what-you-will-achieve">What you will achieve</h3>
<ul>
<li>Building a Single Page App!</li>
<li>Learning the basics of <a href="http://backbonejs.org/">Backbone.js</a>, an example of a single page of a MVC JavaScript framework</li>
<li>Learning the basics of <a href="http://backbonejs.org/">Angular.js</a>, an other example of a single page of a MVC JavaScript framework</li>
<li>Using an application Assembler, <a href="http://brunch.io/">Brunch</a>, to make your life even easier</li>
</ul>
<h3 id="source-code">Source code</h3>
<ul>
<li>The source code the Backbone.js tutorial can be found <a href="https://github.com/cozy/cozy-tutorial/tree/spa-final">here</a></li>
<li>The source code the Angular.js  tutorial can be found <a href="https://github.com/cozy/cozy-tutorial/tree/spa-angular">here</a></li>
</ul>
<h3 id="get-ready">Get ready</h3>
<p>First, install Brunch:</p>
<pre class="highlight"><code class="hljs javascript">npm install -g brunch
</code></pre>
<p>Then, get the source we prepared for you to bootstrap the tutorial.</p>
<pre class="highlight"><code class="hljs bash">// For backbone
git <span class="hljs-built_in">clone</span> https://github.com/cozy/cozy-tutorial.git --branch spa spa-bookmarks
// For angular
git <span class="hljs-built_in">clone</span> https://github.com/cozy/cozy-tutorial.git --branch spa-angular spa-bookmarks
// For both Angular and Backbone
<span class="hljs-built_in">cd</span> spa-bookmarks/
npm install
<span class="hljs-built_in">cd</span> client/
npm install
</code></pre>
<p>Note your command includes <code>npm install</code> twice. The client&#39;s one is for Brunch specific modules. We&#39;ll come back to what Brunch does soon.</p>
<h2 id="a-single-page-app-with-backbone-js">A Single Page App with Backbone.js</h2>
<h3 id="file-structure-of-the-bootstrap-backbone-application">File structure of the bootstrap Backbone application</h3>
<p>You already know about the server part of the file structure, so let&#39;s focus on the client folder.</p>
<ul>
<li>client/<ul>
<li>app/ - where you put your files while developing<ul>
<li>assets/ - all your static assets: images, fonts, ...<ul>
<li>index.html the entrance point of your application</li>
</ul>
</li>
<li>collections/</li>
<li>models/</li>
<li>templates/ - where your templates (Jade in our case) will be</li>
<li>views/</li>
<li>application.js - bootstrap the Backbone app</li>
<li>initialize.js - start the whole application when ready</li>
<li>router.js - the Backbone router</li>
</ul>
</li>
<li>public/ - where the &quot;built&quot; files are</li>
<li>vendor/<ul>
<li>scripts/ - the JS libraries we need</li>
</ul>
</li>
<li>config.js - Brunch configuration</li>
<li>package.json - Brunch modules to install</li>
</ul>
</li>
</ul>
<p>There are two parts in the file structure: the &quot;app&quot; where you will write your code, and &quot;public&quot; where Brunch will output everything you write correctly into one nice JavaScript file.</p>
<p>Another important thing is that the folder structure is not <strong>constrained at all</strong>. It is a design choice from us and you can change the way you like, but don&#39;t forget to adjust the Brunch configuration afterwards.</p>
<h3 id="discovering-backbone">Discovering Backbone</h3>
<p>We set up a template with a working Backbone app through Brunch so you can start quickly. But before writing code, let&#39;s look at what Backbone is.</p>
<p>Backbone is a MVC framework for JavaScript that gives you everything you might want to build a flexible and powerful single page application.</p>
<p>As a result, your application will be made of:</p>
<ul>
<li>a router that will allow you to handle multiple pages in your single page app</li>
<li>collections and models to store and manipulate your data</li>
<li>views to handle the logic of rendering the data</li>
<li>templates will represent the to-be-output HTML</li>
</ul>
<p>The glue is Backbone&#39;s observer/observable pattern that allows a lower coupling between each part.
<br /><br /></p>
<p>How does our template work? In the app/assets/index.html we load the JavaScript we need, and call the &quot;initialize&quot; script. This last action ensures us that the DOM has been loaded and starts the Backbone application by creating and initializing the router.</p>
<p>Then the router creates the main view and gives it the collection of bookmarks.
Then the view is rendered. The render process is: load the template, put data in the template, add it to the DOM at the right place.</p>
<p>Now we&#39;ve seen what Backbone is and how this tutorial has been bootstrapped, let&#39;s write some code!</p>
<h3 id="adding-a-new-bookmark">Adding a new bookmark</h3>
<p>The provided code displays a collection of bookmarks. Let&#39;s bind our &quot;new bookmark&quot; form to Backbone.</p>
<p>Along the &quot;el&quot; and the &quot;template&quot; attribute, add the event binding:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// apps/views/app_view.js</span>
el: <span class="hljs-string">'body'</span>,
<span class="hljs-attr">template</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'../templates/home'</span>),
<span class="hljs-attr">events</span>: {
    <span class="hljs-string">"click #add-bookmark"</span>: <span class="hljs-string">"createBookmark"</span>
},
</code></pre>
<p>This means that when the user clicks on the #add-bookmark button, the &quot;createBookmark&quot; callback will be triggered. So let&#39;s define the &quot;createBookmark&quot; function in the code:</p>
<pre class="highlight"><code class="hljs javascript">createBookmark: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-comment">// submit button reload the page, we don't want that</span>
    event.preventDefault();

    <span class="hljs-comment">// create a new model</span>
    <span class="hljs-keyword">var</span> bookmark = <span class="hljs-keyword">new</span> Bookmark({
        <span class="hljs-attr">title</span>: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'input[name="title"]'</span>).val(),
        <span class="hljs-attr">url</span>: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'input[name="url"]'</span>).val()
    });

    <span class="hljs-comment">// add it to the collection</span>
    <span class="hljs-keyword">this</span>.collection.add(bookmark);
}
</code></pre>
<p>You will need the &quot;Bookmark&quot; class, so put this at the top of the file:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-keyword">var</span> Bookmark = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/bookmark'</span>);
</code></pre>
<p>If you try it, nothing will happen, and it&#39;s normal. Let&#39;s bind the view to the collection, so it can change when a new bookmark is created:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// initialize is automatically called once after the view is constructed</span>
initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"add"</span>, <span class="hljs-keyword">this</span>.onBookmarkAdded);
},
<span class="hljs-attr">onBookmarkAdded</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
    <span class="hljs-comment">// re-render the view</span>
    <span class="hljs-keyword">this</span>.render();
}
</code></pre>
<p>The new bookmark should now be displayed!</p>
<h3 id="using-a-separate-view-for-the-bookmark">Using a separate view for the bookmark</h3>
<p>If you want to fully take advantage of what Backbone offers you, you must think modular.</p>
<p>We have a list of bookmarks and rendering them each time we add a new one could be a bottleneck one day. Also it could be better if we could manipulate each bookmark independently, so deletion would be dead easy to implement. Let&#39;s do this!</p>
<p>Create a new view <code>app/views/bookmark.js</code>:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/views/bookmarks.js</span>
<span class="hljs-built_in">module</span>.exports = AppView = Backbone.View.extend({

    <span class="hljs-attr">tagName</span>: <span class="hljs-string">'li'</span>,
    <span class="hljs-attr">template</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'../templates/bookmark'</span>),

    <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.$el.html(<span class="hljs-keyword">this</span>.template({
            <span class="hljs-attr">bookmark</span>: <span class="hljs-keyword">this</span>.model.toJSON()
        }));
    }
});
</code></pre>
<p>The tagname will be used when we create a view to automatically create a &quot;li&quot; DOM node.</p>
<p>Now create the bookmark template <code>app/templates/bookmark.jade</code>:</p>
<pre class="highlight"><code class="hljs bash">a(href=bookmark.url)= bookmark.title
| &amp;nbsp;- (
a.delete delete
| )
</code></pre>
<p>We must also change the way the app_view renders. First clean the home template (<code>apps/templates/home.jade</code>) by removing everything under the &quot;ul&quot; tag.</p>
<p>Next rewrite the render function that way:</p>
<pre class="highlight"><code class="hljs javascript">render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-comment">// we render the template</span>
    <span class="hljs-keyword">this</span>.$el.html(<span class="hljs-keyword">this</span>.template());

    _this = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>.collection.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bookmark</span>) </span>{
        _this.onBookmarkAdded(bookmark);
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
},
<span class="hljs-attr">onBookmarkAdded</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bookmark</span>) </span>{
    <span class="hljs-comment">// render the specific element</span>
    bookmarkView = <span class="hljs-keyword">new</span> BookmarkView({
        <span class="hljs-attr">model</span>: bookmark
    });
    bookmarkView.render();
    <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'ul'</span>).append(bookmarkView.$el);
}
</code></pre>
<p>Everything should be working as before, but each bookmark is rendered separately, which also means they can be managed separately. Let&#39;s see how we can easily add the &quot;delete&quot; feature now.</p>
<h3 id="removing-a-bookmark">Removing a bookmark</h3>
<p>In the bookmark view, add the &quot;delete&quot; feature like we did earlier for the &quot;create&quot; one.</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/views/bookmark.js</span>
events: {
    <span class="hljs-string">'click a.delete'</span>: <span class="hljs-string">'deleteBookmark'</span>
},

<span class="hljs-attr">deleteBookmark</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.model.destroy();
    <span class="hljs-keyword">this</span>.remove();
}
</code></pre>
<p>Note that the events declaration is reduced to the children of the view in the DOM, so &quot;a.delete&quot; actually means (jQuery style): <code>$(document).find(&#39;theview&#39;).find(&#39;a.delete&#39;)</code>.</p>
<p>Your application is still useless (we came back in the first tutorial state :(), because the changes are not saved in the server. Let&#39;s fix this!</p>
<h3 id="binding-your-single-page-app-with-your-server">Binding your single page app with your server</h3>
<p>To achieve that we must tell the Backbone collection where the server is and then create the right route on the server side.</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/collections/bookmarks.js</span>
Bookmark = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/bookmark'</span>);
<span class="hljs-built_in">module</span>.exports = Bookmarks = Backbone.Collection.extend({
    <span class="hljs-attr">model</span>: Bookmark,
    <span class="hljs-attr">url</span>: <span class="hljs-string">'bookmarks'</span>
});
</code></pre>
<p>We also need to tell Backbone to properly persist the model on the server:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/views/app_view.js</span>
createBookmark: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-comment">// submit button reload the page, we don't want that</span>
    event.preventDefault();

    <span class="hljs-comment">// add it to the collection</span>
    <span class="hljs-keyword">this</span>.collection.create({
        <span class="hljs-attr">title</span>: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'input[name="title"]'</span>).val(),
        <span class="hljs-attr">url</span>: <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">'input[name="url"]'</span>).val()
    });
}
</code></pre>
<p>Make sure you also change the render function from the app_view to retrieve the bookmarks from the database:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/views/app_view.js</span>
render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-comment">// we render the template</span>
    <span class="hljs-keyword">this</span>.$el.html(<span class="hljs-keyword">this</span>.template());

    <span class="hljs-comment">// fetch the bookmarks from the database</span>
    <span class="hljs-keyword">this</span>.collection.fetch();
}
</code></pre>
<h2 id="what-if-i-want-to-use-angularjs-">What if i want to use AngularJS ?</h2>
<p>That is not a problem. As we said, you&#39;re completely free to choose the technology you&#39;re the most comfortable in. So let&#39;s get into it and see what could be the simplist way to apply our bookmark application into an Angular way.</p>
<h3 id="file-structure-of-the-angularjs-application">File structure of the AngularJS application</h3>
<ul>
<li>client/<ul>
<li>app/ - where you put your files while developing<ul>
<li>assets/ - all your static assets: images, fonts, ...<ul>
<li>partials/ - templates rendered by ng-view<ul>
<li>home.html</li>
</ul>
</li>
<li>index.html - the entrance point of your application</li>
</ul>
</li>
<li>scripts/ - angular controllers (Ctrl), factories (Fctr)...<ul>
<li>books/ - angular fonctionalities related to books<ul>
<li>Book.Fctr.js - Books factories (Object Oriented)</li>
<li>Book.Ctrl.js - Books controller (calls the factory)</li>
</ul>
</li>
</ul>
</li>
<li>stylesheets/ - the css to make it pretty</li>
<li>app.module.js - main module (route configuration, angular lib importations...)</li>
</ul>
</li>
<li>public/ - where the &quot;built&quot; files are</li>
<li>vendor/<ul>
<li>scripts/ - the angularJS libraries we need</li>
</ul>
</li>
<li>config.js - Brunch configuration</li>
<li>package.json - Brunch modules to install</li>
</ul>
</li>
</ul>
<h3 id="discovering-angularjs">Discovering AngularJS</h3>
<p>AngularJS is an Open-Source framework maintained by Google. One of the must loved feature is the <a href="https://docs.angularjs.org/tutorial/step_04">Two-way data binding</a>. It allows for a reduction in the amount of code required to create dynamic views.</p>
<p>Another popular feature is directives and it will get even more important when <a href="https://angular.io/">Angular 2.0</a> (the current version is v1.4.4) will come out, which allow developers to extend HTML by attaching special behaviors to parts of the DOM. For example, <a href="https://docs.angularjs.org/api/ng/directive/ngRepeat">ng-repeat</a> is a directive that allows developers to repeat an element, making it very handy for doing things like printing an array of items to the page. In addition to the directives that come with Angular, you can create your own, allowing for a great deal of flexibility in crafting behaviors for the UI.</p>
<h3 id="links">Links</h3>
<ul>
<li>A <a href="https://www.youtube.com/watch?v=-8P8NO8X-mQ">conference</a> explains how Angular 2 will only be centered on Directives</li>
<li>A <a href="http://blog.revolunet.com/blog/2014/02/14/angularjs-services-inheritance/">tutorial</a> that explains how to build a Object Oriented framework and get closer to Angular 2 new architecture</li>
<li>A <a href="https://github.com/johnpapa/angular-styleguide">document</a> that explains how to write clean code in Angular.</li>
<li><a href="https://karma-runner.github.io/0.8/plus/AngularJS.html">Karma</a>. A generator for testing AngularJS.</li>
<li>A nice <a href="https://www.airpair.com/angularjs/posts/top-10-mistakes-angularjs-developers-make">tutorial</a> that explains what you shouldn&#39;t do in AngularJS</li>
</ul>
<p>Important : because of his evolution, a lot of the angularJS tutorial get&#39;s depreciated very fast.</p>
<p>As a result, your application will be made of:</p>
<ul>
<li>a template engine with binding expressions baked-in</li>
<li>a categorization of your application building blocks into several types : Controllers, Directives, Factories... </li>
</ul>
<p>Now we&#39;ve seen what Angular is, let&#39;s write some code !</p>
<h3 id="adding-a-new-bookmark">Adding a new bookmark</h3>
<p>This add function will get the bookItem filled in the form in the home.html file. </p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/assets/scripts/bookmarks/Home.Ctr.js</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">bookItem</span>) </span>{
    <span class="hljs-keyword">var</span> defaultForm = {
      <span class="hljs-attr">title</span> : <span class="hljs-string">""</span>,
      <span class="hljs-attr">link</span> : <span class="hljs-string">""</span>
    };
    <span class="hljs-comment">// set the book in the factory (for an Object Oriented way)</span>
    bookmark.setBookmark(bookItem);
    <span class="hljs-comment">// will send the data to the factory to make a call to the server</span>
    bookmark.addBookmark().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// vm.bookmarks will be bound to home.html with ng-repeat.</span>
        vm.bookmarks.push(bookmark._bookmark);

        <span class="hljs-comment">// useful to reset the form in the view</span>
        vm.bookmark = defaultForm;
        $scope.form.$setPristine(); 
    });
}
</code></pre>
<p>Now create the bookmark template <code>app/assets/partials/home.html</code>:</p>
<pre class="highlight"><code class="hljs bash">&lt;tr ng-repeat=<span class="hljs-string">"bookmark in home.bookmarks track by <span class="hljs-variable">$index</span>"</span>&gt;
    &lt;td&gt;{{bookmark.title}}&lt;/td&gt;
    &lt;td&gt;{{bookmark.link}}&lt;/td&gt;
    &lt;td&gt;
        &lt;button class=<span class="hljs-string">"btn btn-default"</span> ng-click=<span class="hljs-string">"home.removeBookmark(<span class="hljs-variable">$index</span>, bookmark.id)"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"submit"</span>&gt;Delete&lt;/button&gt;
    &lt;/td&gt;
&lt;/tr&gt;
</code></pre>
<p>Next write the factory to make a <code>post</code> call to the server.</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/assets/scripts/bookmarks/Bookmark.Fctr.js</span>

<span class="hljs-comment">// ! important : define your route depended to the name of your app</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addBookmark</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-comment">// will call the post route of the bookmark API</span>
    <span class="hljs-keyword">return</span> $http.post(<span class="hljs-string">'/apps/tutorial-angularjs/add'</span>, self._bookmark).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{

        <span class="hljs-comment">// store the response of the API in the factory</span>
        self._bookmark = response.data;
        <span class="hljs-keyword">return</span> response;
    });
}
</code></pre>
<p>Let&#39;s see how we can easily add the &quot;delete&quot; feature now.</p>
<h3 id="removing-a-bookmark">Removing a bookmark</h3>
<p>In the bookmark controller (Home.Ctrl.js), add the &quot;removeBookmark&quot; feature like we did earlier for the &quot;add&quot; one.</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// app/assets/scripts/bookmarks/Home.Ctrl.js</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeBookmark</span>(<span class="hljs-params">index, bookmarkId</span>) </span>{
    <span class="hljs-comment">// set the bookmark id to delete</span>
    bookmark.setId(bookmarkId);

    <span class="hljs-comment">// delete the bookmark related to the bookmark id</span>
    book.deleteBook().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

        <span class="hljs-comment">// refresh the page when deleted</span>
        vm.books.splice(index, <span class="hljs-number">1</span>);
    });
}
</code></pre>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// ! important : Define your route depended to the name of your app</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteBookmark</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-comment">// will call the get route of the bookmark API</span>
    <span class="hljs-keyword">return</span> $http.get(<span class="hljs-string">'/apps/tutorial-angularjs/delete/'</span> + self._id).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
        <span class="hljs-keyword">return</span> response;
    });
}
</code></pre>
<h2 id="what-about-the-server-">What about the server ?</h2>
<p>Backbone or Angular considers the server is RESTful and that it sends and receives JSON, so we change the server routes to match the standard:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// server/controllers/routes.js</span>
<span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-string">'bookmarks'</span>: {
        <span class="hljs-attr">get</span>: bookmarks.list,
        <span class="hljs-attr">post</span>: bookmarks.add,
    },
    <span class="hljs-string">'bookmarks/:id'</span>: {
        <span class="hljs-attr">del</span>: bookmarks.delete
    }
};
</code></pre>
<p>And adjust the controller in the right way:</p>
<pre class="highlight"><code class="hljs javascript"><span class="hljs-comment">// server/controllers/bookmarks.js</span>
Bookmark = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/bookmark'</span>);

<span class="hljs-built_in">module</span>.exports.list = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
    Bookmark.all(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, bookmarks</span>) </span>{
        <span class="hljs-keyword">if</span>(err !== <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// Here we want to handle errors our way so Backbone</span>
            <span class="hljs-comment">// understands them.</span>
            res.status(<span class="hljs-number">500</span>).send({<span class="hljs-attr">error</span>: <span class="hljs-string">"An error has occurred -- "</span> + err});
        }
        <span class="hljs-keyword">else</span> {
            res.send(bookmarks);
        }
    });
};

<span class="hljs-built_in">module</span>.exports.add = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
    Bookmark.create(req.body, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, bookmark</span>) </span>{
        <span class="hljs-keyword">if</span>(err !== <span class="hljs-literal">null</span>) {
            next(err);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 201 is the HTTP code for creation success.</span>
            res.status(<span class="hljs-number">201</span>).send({<span class="hljs-attr">success</span>: <span class="hljs-string">"Creation succeeded"</span>}); 
        }
    });
};

<span class="hljs-built_in">module</span>.exports.delete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
    Bookmark.find(req.params.id, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, bookmark</span>) </span>{
        <span class="hljs-keyword">if</span>(err !== <span class="hljs-literal">null</span>) {
            res.status(<span class="hljs-number">500</span>).send({<span class="hljs-attr">error</span>: <span class="hljs-string">"An error has occurred -- "</span> + err});
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(bookmark === <span class="hljs-literal">null</span>) {
            res.status(<span class="hljs-number">404</span>).send({<span class="hljs-attr">error</span>: <span class="hljs-string">"Bookmark not found"</span>});
        }
        <span class="hljs-keyword">else</span> {
            bookmark.destroy(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">if</span>(err !== <span class="hljs-literal">null</span>) {
                    res.status(<span class="hljs-number">500</span>).send({<span class="hljs-attr">error</span>: <span class="hljs-string">"An error has occurred -- "</span> + err});
                }
                <span class="hljs-keyword">else</span> {
                    res.status(<span class="hljs-number">204</span>).send({<span class="hljs-attr">success</span>: <span class="hljs-string">"Deletion succeeded"</span>});
                }
            });
        }
    });
};
</code></pre>
<p>You server is now a RESTful API that allows your single page app to request it easily thanks to Backbone and AngularJS.</p>
<p>Now let&#39;s see what exactly Brunch does.</p>
<h2 id="automatically-build-your-application-with-brunch">Automatically build your application with Brunch</h2>
<p>Brunch gathers everything you will write in the app folder and wrap it with RequireJS (which allows you to use the &quot;require&quot; keyword), and put it all together in one JavaScript file.</p>
<p>It can also process your file to minify it (for example). If you want to write Coffee Script instead of JavaScript, Brunch will compile it for you. If you want to use Jade, it will compile it for you.
You can use pretty much everything you want to for templates (Jade, Handlebars, Underscore, ...) or styles (Stylus, LESS, SASS, ...), just install the relevant node modules and adjust the configuration file.</p>
<p>If you want to know everything about Brunch, please check out their <a href="http://brunch.io/">website</a> (it is not mandatory for this tutorial though).</p>
<p>Brunch is also awesome because it detects when a file changes and recompiles the code automatically, so everything is smooth for you.</p>
<p>To start brunch, open a terminal:</p>
<pre class="highlight"><code class="hljs bash"><span class="hljs-built_in">cd</span> tutorial-spa/client/
brunch w
</code></pre>
<p>From now on, you shouldn&#39;t be modifying a file outside the app/ directory.</p>
<h2 id="what-s-next-">What&#39;s next?</h2>
<p>This tutorial doesn&#39;t cover every aspect and good practice of Backbone and AngularJS but it
should give you good insight into how you can build awesome single page apps.</p>
<p>Finally, to you make your application Cozy-ready, you have to do one unfamiliar
thing: You have to commit the build of your application client when you push your
git repository. Why? Because the Cozy platform doesn&#39;t run any build process and
we don&#39;t have a strong package manager yet. So the only way for the platform to have
the finished build of your app is to fetch it as part of the git repository.</p>
<p>Besides this, there is a lot of cool stuff you can do with Cozy and you can
ask us on IRC or by email what the next steps are or just to get help from us.</p>
<p><br /><br />
We are eager to see what application you will bring to the Cozy community, don&#39;t hesitate to show us your work!
<br /><br /></p>
<p>To go further in your study of Cozycloud, you can check out the <a href="/en/hack/cookbooks/">cookbooks</a>!</p>
<p>We also provide <a href="/en/hack/application-skeletons/">application skeletons</a> to get you started quickly.
Choose the one you like, or add yours.</p>

      </div>
      <footer id="footer" role="contentinfo"><a href="https://github.com/cozy"><img src="/assets/images/icons/icon-github.svg">Github</a><a href="irc://irc.freenode.net/cozycloud"><img src="/assets/images/icons/icon-message.svg">IRC</a><a href="https://forum.cozy.io"><img src="/assets/images/icons/icon-smiley.svg">Forum</a><a href="mailto:contact@cozycloud.cc"><img src="/assets/images/icons/icon-mail.svg">Contact</a><a href="https://www.cozy.io"><img src="/assets/images/icons/icon-cloud.svg">Cozy's site</a></footer>
    </div><script defer="defer"  src="/vendors/javascripts/jquery-2.0.3.min.js"></script><script defer="defer"  src="/vendors/javascripts/bootstrap.min.js"></script><script defer="defer"  src="/assets/javascripts/main.js"></script>
    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['disableCookies']);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
      var u="//piwik.cozycloud.cc/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', 7]);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <noscript>
      <p><img src="https://piwik.cozycloud.cc/piwik.php?idsite=7" style="border:0" alt=""></p>
    </noscript>
  </body>
</html>